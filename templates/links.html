<!doctype html>
<html
  xmlns:th="https://www.thymeleaf.org"
  th:replace="~{modules/layout :: html(title = ${singlePage != null ? singlePage.spec.title : '朋友们'}, content = ~{::content}, head = ~{::head})}"
  data-fp="55018a22"
  data-theme-build="1770439357"
>
  <th:block th:fragment="head">
    <link rel="stylesheet" th:href="@{/assets/css/links.css}" />
    <script>
      window.LINK_CONFIG = {
        offlineLabel:
          '[[${theme.config.links != null && theme.config.links.offlineLabel != null && !#strings.isEmpty(theme.config.links.offlineLabel) ? theme.config.links.offlineLabel : "失联咯~"}]]'
      }
    </script>
    <script th:src="@{/assets/js/links.js}" defer></script>
    <script th:if="${pluginFinder.available('link-submit')}" th:src="@{/assets/js/links-submit.js}" defer></script>
  </th:block>
  <th:block th:fragment="content">
    <main class="main">
      <div class="container">
        <section class="links-hero" data-aos="fade-up">
          <h1 class="links-hero-title" th:text="${singlePage != null ? singlePage.spec.title : '朋友们'}">朋友们</h1>
          <p class="links-hero-desc">海内存知己，天涯若比邻</p>
          <div
            class="links-hero-stats"
            th:with="totalLinks = ${#lists.isEmpty(groups) ? 0 : #aggregates.sum(groups.![links.size()])}"
          >
            <span class="links-count">
              已收录
              <strong th:text="${totalLinks}">0</strong>
              位朋友
            </span>
            <button class="links-random-btn" onclick="visitRandomLink()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5" />
              </svg>
              随机访问
            </button>
          </div>
        </section>
        <section class="link-section" data-aos="fade-up" data-aos-delay="100">
          <div class="link-grid">
            <th:block th:each="group, groupStat : ${groups}">
              <a
                th:each="link, linkStat : ${group.links}"
                th:href="${link.spec.url}"
                class="link-card"
                data-link
                target="_blank"
                rel="noopener"
                data-aos="zoom-in"
                th:attr="data-aos-delay=${150 + groupStat.index * 50 + linkStat.index * 30}"
              >
                <div class="link-avatar-wrap">
                  <img
                    th:if="${link.spec.logo}"
                    class="link-avatar"
                    th:src="${link.spec.logo}"
                    th:alt="${link.spec.displayName}"
                    loading="lazy"
                  />
                  <div
                    th:unless="${link.spec.logo}"
                    class="link-avatar-placeholder"
                    th:text="${#strings.substring(link.spec.displayName, 0, 1)}"
                  >
                    L
                  </div>
                </div>
                <div class="link-info">
                  <span class="link-name" th:text="${link.spec.displayName}">链接名称</span>
                  <span class="link-desc" th:text="${link.spec.description}">链接描述</span>
                </div>
                <span class="link-group-tag" th:text="${group.spec.displayName}">分组</span>
              </a>
            </th:block>
          </div>
        </section>
        <div class="link-apply" data-aos="fade-up">
          <h3 class="link-apply-title">申请友链</h3>
          <p class="link-apply-desc">欢迎交换友链，请提交你的站点信息</p>
          <div class="link-apply-info">
            <span>
              <span class="label">名称：</span>
              <span
                th:text="${#strings.isEmpty(theme.config.links.ownerName) ? theme.config.basic.title : theme.config.links.ownerName}"
              >
                站点名称
              </span>
            </span>
            <span>
              <span class="label">链接：</span>
              <span th:text="${#strings.isEmpty(theme.config.links.ownerUrl) ? site.url : theme.config.links.ownerUrl}">
                站点链接
              </span>
            </span>
            <span
              th:if="${!#strings.isEmpty(theme.config.links.ownerAvatar) or !#strings.isEmpty(theme.config.basic.logo)}"
            >
              <span class="label">头像：</span>
              <span
                th:text="${#strings.isEmpty(theme.config.links.ownerAvatar) ? theme.config.basic.logo : theme.config.links.ownerAvatar}"
              >
                头像链接
              </span>
            </span>
            <span>
              <span class="label">描述：</span>
              <span
                th:text="${#strings.isEmpty(theme.config.links.ownerDescription) ? theme.config.basic.description : theme.config.links.ownerDescription}"
              >
                站点描述
              </span>
            </span>
            <th:block
              th:if="${pluginFinder.available('link-submit') and (theme.config.links.showApplyButton == null or theme.config.links.showApplyButton)}"
            >
              <a href="javascript:void(0)" onclick="openLinkSubmitModal()" class="link-submit-text" title="申请友链">
                申请友链 ›
              </a>
            </th:block>
          </div>
        </div>
      </div>
    </main>
    <div id="customToast" class="custom-toast">
      <div class="toast-icon"></div>
      <div class="toast-content">
        <div class="toast-title"></div>
        <div class="toast-message"></div>
      </div>
    </div>
    <div id="linkSubmitModal" class="link-submit-modal" th:if="${pluginFinder.available('link-submit')}">
      <div class="link-submit-overlay" onclick="closeLinkSubmitModal()"></div>
      <div class="link-submit-dialog">
        <div class="link-submit-header">
          <h3>申请友链</h3>
          <button class="link-submit-close" onclick="closeLinkSubmitModal()">×</button>
        </div>
        <form id="linkSubmitForm" class="link-submit-form" onsubmit="submitLinkForm(event)">
          <div class="form-group">
            <label for="displayName">
              站点名称
              <span class="required">*</span>
            </label>
            <input type="text" id="displayName" name="displayName" required placeholder="请输入站点名称" />
          </div>
          <div class="form-group">
            <label for="url">
              站点链接
              <span class="required">*</span>
            </label>
            <input type="url" id="url" name="url" required placeholder="https://example.com" />
          </div>
          <div class="form-group">
            <label for="logo">
              站点头像
              <span class="required">*</span>
            </label>
            <div class="logo-input-wrapper">
              <input
                type="url"
                id="logo"
                name="logo"
                required
                placeholder="https://example.com/logo.png"
                oninput="previewLogo(this.value)"
              />
              <div class="logo-preview" id="logoPreview">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                  <circle cx="8.5" cy="8.5" r="1.5" />
                  <polyline points="21 15 16 10 5 21" />
                </svg>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="email">
              联系邮箱
              <span class="required">*</span>
            </label>
            <input type="email" id="email" name="email" required placeholder="your@email.com" />
          </div>
          <div class="form-group">
            <label for="description">
              站点描述
              <span class="required">*</span>
            </label>
            <textarea
              id="description"
              name="description"
              required
              placeholder="简单介绍一下你的站点"
              rows="3"
            ></textarea>
          </div>
          <div class="form-group">
            <label for="groupName">
              友链分组
              <span class="required">*</span>
            </label>
            <div class="custom-select" id="customGroupSelect">
              <div class="custom-select-trigger" onclick="toggleGroupSelect()">
                <span class="custom-select-value">请选择分组</span>
                <svg class="custom-select-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="custom-select-dropdown" id="groupSelectDropdown">
                <div class="custom-select-option" data-value="">请选择分组</div>
              </div>
            </div>
            <input type="hidden" id="groupName" name="groupName" required />
          </div>
          <div class="form-group">
            <label for="rssUrl">RSS 订阅地址</label>
            <input type="url" id="rssUrl" name="rssUrl" placeholder="https://example.com/rss.xml (可选)" />
          </div>
          <div class="form-actions">
            <button type="button" class="btn-cancel" onclick="closeLinkSubmitModal()">取消</button>
            <button type="submit" class="btn-submit">提交申请</button>
          </div>
        </form>
      </div>
    </div>
    <div id="linkConfirmModal" class="link-confirm-modal">
      <div class="link-confirm-content">
        <div class="link-confirm-header">
          <span>
            即将离开本站访问：
            <strong class="link-target-name"></strong>
          </span>
          <button class="link-confirm-close" onclick="closeLinkConfirm()">×</button>
        </div>
        <div class="link-confirm-body">
          <p class="link-warning-text">本站不对外部链接内容负责，请注意甄别信息真伪</p>
          <div class="link-slider-container">
            <div class="link-slider-bg"></div>
            <div class="link-slider-track">
              <div class="link-slider-text">拖动滑块验证</div>
              <div class="link-slider-button">›</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </th:block>
</html>
